<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>API reference - Valhalla</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Valhalla</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Overview</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">API reference</a>
                    </li>
                
                
                
                    <li >
                        <a href="../add-routing-to-a-map/">Tutorial</a>
                    </li>
                
                
                
                    <li >
                        <a href="../decoding/">Decoding</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../add-routing-to-a-map/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#mapzen-turn-by-turn-routing-service-api-reference">Mapzen Turn-by-Turn routing service API reference</a></li>
        
            <li><a href="#api-keys-and-service-limits">API keys and service limits</a></li>
        
            <li><a href="#inputs-of-a-route">Inputs of a route</a></li>
        
            <li><a href="#outputs-of-a-route">Outputs of a route</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="mapzen-turn-by-turn-routing-service-api-reference">Mapzen Turn-by-Turn routing service API reference</h1>
<p>Mapzen Turn-by-Turn, powered by the Valhalla engine, is an open-source routing service that lets you integrate routing and navigation into a web or mobile application. This page documents the inputs and outputs to the service.</p>
<p>The routing service is in active development. You can follow the <a href="https://mapzen.com/blog">Mapzen blog</a> to get updates. To report software issues or suggest enhancements, open an issue in GitHub (use the <a href="https://github.com/valhalla/thor">Thor repository</a> for comments about route paths or <a href="https://github.com/valhalla/odin">Odin repository</a> for narration). You can also send a message to routing@mapzen.com.</p>
<p>The default logic for the OpenStreetMap tags, keys, and values used when routing are documented on an <a href="http://wiki.openstreetmap.org/wiki/OSM_tags_for_routing/Valhalla">OSM wiki page</a>.</p>
<h2 id="api-keys-and-service-limits">API keys and service limits</h2>
<p>To use the Mapzen Turn-by-Turn routing service, you must first obtain an developer API key from Mapzen. Sign in at https://mapzen.com/developers to create and manage your API keys.</p>
<p>Mapzen Turn-by-Turn is a shared routing service. As such, there are limitations on requests, maximum distances, and numbers of locations to prevent individual users from degrading the overall system performance.</p>
<p>The following limitations are currently in place:</p>
<ul>
<li>Pedestrian routes have a limit of 50 locations and 250 kilometers.</li>
<li>Bicycle routes have a limit of 50 locations and 500 kilometers.</li>
<li>Automobile routes have a limit of 20 locations and 5,000 kilometers.</li>
<li>Multimodal routes have a limit of 50 locations and 500 kilometers.</li>
</ul>
<p>The distance limit is the total "as the crow-flies" distance along a path through successive locations.</p>
<p>Limits may be increased in the future, but you can contact routing@mapzen.com if you encounter rate limit status messages and need higher limits in the meantime.</p>
<h2 id="inputs-of-a-route">Inputs of a route</h2>
<p>The route request takes the form of <code>valhalla.mapzen.com/route?json={}&amp;api_key=</code>, where the JSON inputs inside the <code>{}</code> include location information, name and options for the costing model, and output options. Here is an example request:</p>
<p><code>valhalla.mapzen.com/route?json={"locations":[{"lat":42.358528,"lon":-83.271400,"street":"Appleton"},{"lat":42.996613,"lon":-78.749855,"street":"Ranch Trail"}],"costing":"auto","costing_options":{"auto":{"country_crossing_penalty":2000.0}},"directions_options":{"units":"miles"},"id":"my_work_route"}&amp;api_key=mapzen-xxxxxx</code></p>
<p>This request provides automobile routing between the Detroit, Michigan area and Buffalo, New York, with an optional street name parameter to improve navigation at the start and end points. It attempts to avoid routing north through Canada by adding a penalty for crossing international borders. The resulting route is displayed in miles.</p>
<p>There is an option to name your route request.  You can do this by appending the following to your request <code>&amp;id=</code>.  The <code>id</code> is returned with the response so a user could match to the corresponding request.</p>
<p>Note that you must append your own <a href="https://mapzen.com/developers">API key</a> to the URL, following <code>&amp;api_key=</code> at the end.</p>
<h3 id="locations">Locations</h3>
<p>You specify locations as an ordered list of two or more locations within a JSON array. Locations are visited in the order specified.  See the <code>API keys and service limits</code> section above for the locations and distance limits.</p>
<p>A location must include a latitude and longitude in decimal degrees. The coordinates can come from many input sources, such as a GPS location, a point or a click on a map, a geocoding service, and so on. Note that Mapzen Turn-by-Turn is a routing service only, so cannot search for names or addresses or perform geocoding or reverse geocoding. External search services, such as <a href="https://mapzen.com/projects/search">Mapzen Search</a> or <a href="http://wiki.openstreetmap.org/wiki/Nominatim">Nominatim</a>, can be used to find places and geocode addresses, which must be converted to coordinates for input.  </p>
<p>To build a route, you need to specify two <code>break</code> locations. In addition, you can include <code>through</code> locations to influence the route path.</p>
<table>
<thead>
<tr>
<th align="left">Location parameters</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>lat</code></td>
<td align="left">Latitude of the location in degrees.</td>
</tr>
<tr>
<td align="left"><code>lon</code></td>
<td align="left">Longitude of the location in degrees.</td>
</tr>
<tr>
<td align="left"><code>type</code></td>
<td align="left">Type of location, either <code>break</code> or <code>through</code>. A <code>break</code> is a stop, so the first and last locations must be of type <code>break</code>. A <code>through</code> location is one that the route path travels through, and is useful to force a route to go through location. The path is not allowed to reverse direction at the through locations. If no type is provided, the type is assumed to be a <code>break</code>.</td>
</tr>
<tr>
<td align="left"><code>heading</code></td>
<td align="left">(optional) Preferred direction of travel for the start from the location. This can be useful for mobile routing where a vehicle is traveling in a specific direction along a road, and the route should start in that direction. The <code>heading</code> is indicated in degrees from north in a clockwise direction, where north is 0°, east is 90°, south is 180°, and west is 270°.</td>
</tr>
<tr>
<td align="left"><code>street</code></td>
<td align="left">(optional) Street name. The street name may be used to assist finding the correct routing location at the specified latitude, longitude. This is not currently implemented.</td>
</tr>
<tr>
<td align="left"><code>way_id</code></td>
<td align="left">(optional) OpenStreetMap identification number for a polyline [way] (http://wiki.openstreetmap.org/wiki/Way). The way ID may be used to assist finding the correct routing location at the specified latitude, longitude. This is not currently implemented.</td>
</tr>
</tbody>
</table>
<p>Optionally, you can include the following location information without impacting the routing. This information is carried through the request and returned as a convenience.</p>
<ul>
<li><code>name</code> = Location or business name. The name may be used in the route narration directions, such as "You have arrived at <em>&lt;business name&gt;</em>.")</li>
<li><code>city</code> = City name.</li>
<li><code>state</code> = State name.</li>
<li><code>postal_code</code> = Postal code.</li>
<li><code>country</code> = Country name.</li>
<li><code>phone</code> = Telephone number.</li>
<li><code>url</code> = URL for the place or location.</li>
<li><code>side_of_street</code> = (response only) The side of street of a <code>break</code> <code>location</code> that is determined based on the actual route when the <code>location</code> is offset from the street. The possible values are <code>left</code> and <code>right</code>.</li>
<li><code>date_time</code> = (response only) Expected date/time for the user to be at the location using the ISO 8601 format (YYYY-MM-DDThh:mm) in the local time zone of departure or arrival.  For example "2015-12-29T08:00".</li>
</ul>
<p>Future development work includes adding location options and information related to time at each location. This will allow routes to specify a start time or an arrive by time at each location. There is also ongoing work to improve support for <code>through</code> locations.</p>
<h3 id="costing-models">Costing models</h3>
<p>Mapzen Turn-by-Turn uses dynamic, run-time costing to generate the route path. The route request must include the name of the costing model and can include optional parameters available for the chosen costing model.</p>
<table>
<thead>
<tr>
<th align="left">Costing model</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>auto</code></td>
<td align="left">Standard costing for driving routes by car, motorcycle, truck, and so on that obeys automobile driving rules, such as access and turn restrictions. <code>Auto</code> provides a short time path (though not guaranteed to be shortest time) and uses intersection costing to minimize turns and maneuvers or road name changes. Routes also tend to favor highways and higher classification roads, such as motorways and trunks.</td>
</tr>
<tr>
<td align="left"><code>auto_shorter</code></td>
<td align="left">Alternate costing for driving that provides a short path (though not guaranteed to be shortest distance) that obeys driving rules for access and turn restrictions.</td>
</tr>
<tr>
<td align="left"><code>bicycle</code></td>
<td align="left">Standard costing for travel by bicycle, with a slight preference for using <a href="http://wiki.openstreetmap.org/wiki/Key:cycleway">cycleways</a> or roads with bicycle lanes. Bicycle routes follow regular roads when needed, but avoid roads without bicycle access.</td>
</tr>
<tr>
<td align="left"><code>bus</code></td>
<td align="left">Standard costing for bus routes. Bus costing inherits the auto costing behaviors, but checks for bus access on the roads.</td>
</tr>
<tr>
<td align="left"><code>multimodal</code></td>
<td align="left">Currently supports pedestrian and transit. In the future, multimodal will support a combination of all of the above.  Here is an example multimodal request at the current date and time: <code>http://valhalla.mapzen.com/route?json={"locations":[{"lat":40.730930,"lon":-73.991379,"street":"Wanamaker Place"},{"lat":40.749706,"lon":-73.991562,"street":"Penn Plaza"}],"costing":"multimodal","directions_options":{"units":"miles"}}&amp;api_key=mapzen-xxxxxxx</code>  Note that you must append your own <a href="https://mapzen.com/developers">Mapzen API key</a> to the URL, following <code>&amp;api_key=</code> at the end.</td>
</tr>
<tr>
<td align="left"><code>pedestrian</code></td>
<td align="left">Standard walking route that excludes roads without pedestrian access. In general, pedestrian routes are shortest distance with the following exceptions: walkways and footpaths are slightly favored, while steps or stairs and alleys are slightly avoided.</td>
</tr>
</tbody>
</table>
<h4 id="costing-options">Costing options</h4>
<p>Costing methods can have several options that can be adjusted to develop the route path, as well as for estimating time along the path. Specify costing model options in your request using the format of <code>costing_options.type</code>, such as <code>costing_options.auto</code>.</p>
<ul>
<li>Cost options are fixed costs in seconds that are added to both the path cost and the estimated time. Examples of costs are <code>gate_costs</code> and <code>toll_booth_costs</code>, where a fixed amount of time is added. Costs are not generally used to influence the route path; instead, use penalties to do this.</li>
<li>Penalty options are fixed costs in seconds that are only added to the path cost. Penalties can influence the route path determination but do not add to the estimated time along the path. For example, add a <code>toll_booth_penalty</code> to create route paths that tend to avoid toll booths.</li>
<li>Factor options are used to multiply the cost along an edge or road section in a way that influences the path to favor or avoid a particular attribute. Factor options do not impact estimated time along the path, though. Factors must be in the range 0.25 to 100000.0, where factors of 1.0 have no influence on cost. Use a factor less than 1.0 to attempt to favor paths containing preferred attributes, and a value greater than 1.0 to avoid paths with undesirable attributes. Avoidance factors are more effective than favor factors at influencing a path. A factor's impact also depends on the length of road containing the specified attribute, as longer roads have more impact on the costing than very short roads. For this reason, penalty options tend to be better at influencing paths.</li>
</ul>
<h5 id="automobile-and-bus-costing-options">Automobile and bus costing options</h5>
<p>These options are available for <code>auto</code>, <code>auto_shorter</code>, and <code>bus</code> costing methods.</p>
<table>
<thead>
<tr>
<th align="left">Automobile options</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>maneuver_penalty</code></td>
<td align="left">A penalty applied when transitioning between roads that do not have consistent naming–in other words, no road names in common. This penalty can be used to create simpler routes that tend to have fewer maneuvers or narrative guidance instructions. The default maneuver penalty is five seconds.</td>
</tr>
<tr>
<td align="left"><code>gate_cost</code></td>
<td align="left">A cost applied when a <a href="http://wiki.openstreetmap.org/wiki/Tag:barrier%3Dgate">gate</a> is encountered. This cost is added to the estimated time / elapsed time. The default gate cost is 30 seconds.</td>
</tr>
<tr>
<td align="left"><code>toll_booth_cost</code></td>
<td align="left">A cost applied when a <a href="http://wiki.openstreetmap.org/wiki/Tag:barrier%3Dtoll_booth">toll booth</a> is encountered. This cost is added to the estimated and elapsed times. The default cost is 15 seconds.</td>
</tr>
<tr>
<td align="left"><code>toll_booth_penalty</code></td>
<td align="left">A penalty applied to the cost when a <a href="http://wiki.openstreetmap.org/wiki/Tag:barrier%3Dtoll_booth">toll booth</a> is encountered. This penalty can be used to create paths that avoid toll roads. The default toll booth penalty is 0.</td>
</tr>
<tr>
<td align="left"><code>ferry_cost</code></td>
<td align="left">A cost applied when entering a ferry. This cost is added to the estimated and elapsed times. The default cost is 300 seconds (5 minutes).</td>
</tr>
<tr>
<td align="left"><code>use_ferry</code></td>
<td align="left">This value indicates the willingness to take ferries. This is range of values between 0 and 1. Values near 0 attempt to avoid ferries and values near 1 will favor ferries. The default value is 0.5. Note that sometimes ferries are required to complete a route so values of 0 are not guaranteed to avoid ferries entirely.</td>
</tr>
<tr>
<td align="left"><code>country_crossing_cost</code></td>
<td align="left">A cost applied when encountering an international border. This cost is added to the estimated and elapsed times. The default cost is 600 seconds.</td>
</tr>
<tr>
<td align="left"><code>country_crossing_penalty</code></td>
<td align="left">A penalty applied for a country crossing. This penalty can be used to create paths that avoid spanning country boundaries. The default penalty is 0.</td>
</tr>
</tbody>
</table>
<h5 id="bicycle-costing-options">Bicycle costing options</h5>
<p>The default bicycle costing is tuned toward road bicycles with a slight preference for using <a href="http://wiki.openstreetmap.org/wiki/Key:cycleway">cycleways</a> or roads with bicycle lanes. Bicycle routes use regular roads where needed or where no direct bicycle lane options exist, but avoid roads without bicycle access. The costing model recognizes several factors unique to bicycle travel and offers several options for tuning bicycle routes. Several factors unique to travel by bicycle influence the resulting route.</p>
<ul>
<li>The types of roads suitable for bicycling depend on the type of bicycle. Road bicycles (skinny or narrow tires) generally are suited to paved roads or perhaps very short sections of compacted gravel. They are not designed for riding on coarse gravel or most paths and tracks through wooded areas or farmland. Mountain bikes, on the other hand, are able to traverse a wider set of surfaces.</li>
<li>Average travel speed can be highly variable and can depend on bicycle type, fitness and experience of the cyclist, road surface, and hills. The costing model assumes a default speed on smooth, flat roads for each supported bicycle type. This speed can be overridden by an input option. The base speed is modulated by surface type (in conjunction with the bicycle type). Coming soon: logic to modify speed based on the hilliness of a road section.</li>
<li>Bicyclists vary in their tolerance for riding on roads. Most novice bicyclists, and even other bicyclists, prefer cycleways and dedicated cycling paths and would rather avoid all but the quietest neighborhood roads. Other cyclists may be experienced riding on roads and prefer to take roadways because they often provide the fastest way to get between two places. The bicycle costing model accounts for this with a <code>use_roads</code> factor to indicate a cyclist's tolerance for riding on roads.</li>
<li>Bicyclists vary in their fitness level and experience level, and many want to avoid hilly roads, and especially roads with very steep uphill or even downhill sections. Even if the fastest path is over a mountain, many cyclists prefer a flatter path that avoids the climb and descent up and over the mountain.</li>
</ul>
<p>The following options described above for autos also apply to bicycle costing methods: <code>maneuver_penalty</code>, <code>gate_cost</code>, <code>gate_penalty</code>, <code>country_crossing_cost</code>, and <code>country_costing_penalty</code>.</p>
<p>These additional options are available for bicycle costing methods.</p>
<table>
<thead>
<tr>
<th align="left">Bicycle options</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>bicycle_type</code></td>
<td align="left">The type of bicycle. <ul><li><code>Road</code>: a road-style bicycle with narrow tires that is generally lightweight and designed for speed on paved surfaces. </li><li><code>Hybrid</code> or <code>City</code>: a bicycle made mostly for city riding or casual riding on roads and paths with good surfaces.</li><li><code>Cross</code>: a cyclo-cross bicycle, which is similar to a road bicycle but with wider tires suitable to rougher surfaces.</li><li><code>Mountain</code>: a mountain bicycle suitable for most surfaces but generally heavier and slower on paved surfaces.</li><ul></td>
</tr>
<tr>
<td align="left"><code>cycling_speed</code></td>
<td align="left">Cycling speed is the average travel speed along smooth, flat roads. This is meant to be the speed a rider can comfortably maintain over the desired distance of the route. It can be modified (in the costing method) by surface type in conjunction with bicycle type and (coming soon) by hilliness of the road section. When no speed is specifically provided, the default speed is determined by the bicycle type and are as follows: Road = 25 KPH (15.5 MPH), Cross = 20 KPH (13 MPH), Hybrid/City = 18 KPH (11.5 MPH), and Mountain = 16 KPH (10 MPH).</td>
</tr>
<tr>
<td align="left"><code>use_roads</code></td>
<td align="left">A cyclist's propensity to use roads alongside other vehicles. This is a range of values from 0 to 1, where 0 attempts to avoid roads and stay on cycleways and paths, and 1 indicates the rider is more comfortable riding on roads. Based on the <code>use_roads</code> factor, roads with certain classifications and higher speeds are penalized in an attempt to avoid them when finding the best path.</td>
</tr>
<tr>
<td align="left"><code>use_hills</code></td>
<td align="left">A cyclist's desire to tackle hills in their routes. This is a range of values from 0 to 1, where 0 attempts to avoid hills and steep grades even if it means a longer (time and distance) path, while 1 indicates the rider does not fear hills and steeper grades. Based on the <code>use_hills</code> factor, penalties are applied to roads based on elevation change and grade. These penalties help the path avoid hilly roads in favor of flatter roads or less steep grades where available. Note that it is not always possible to find alternate paths to avoid hills (for example when route locations are in mountainous areas).</td>
</tr>
</tbody>
</table>
<h5 id="pedestrian-costing-options">Pedestrian costing options</h5>
<p>These options are available for pedestrian costing methods.</p>
<table>
<thead>
<tr>
<th align="left">Pedestrian options</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>walking_speed</code></td>
<td align="left">Walking speed in kilometers per hour. Defaults to 5.1 km/hr (3.1 miles/hour).</td>
</tr>
<tr>
<td align="left"><code>walkway_factor</code></td>
<td align="left">A factor that modifies the cost when encountering roads or paths that do not allow vehicles and are set aside for pedestrian use. Pedestrian routes generally attempt to favor using these <a href="http://wiki.openstreetmap.org/wiki/Sidewalks">walkways and sidewalks</a>. The default walkway_factor is 0.9, indicating a slight preference.</td>
</tr>
<tr>
<td align="left"><code>alley_factor</code></td>
<td align="left">A factor that modifies (multiplies) the cost when <a href="http://wiki.openstreetmap.org/wiki/Tag:service%3Dalley">alleys</a> are encountered. Pedestrian routes generally want to avoid alleys or narrow service roads between buildings. The default alley_factor is 2.0.</td>
</tr>
<tr>
<td align="left"><code>driveway_factor</code></td>
<td align="left">A factor that modifies (multiplies) the cost when encountering a <a href="http://wiki.openstreetmap.org/wiki/Tag:service%3Ddriveway">driveway</a>, which is often a private, service road. Pedestrian routes generally want to avoid driveways (private). The default driveway factor is 5.0.</td>
</tr>
<tr>
<td align="left"><code>step_penalty</code></td>
<td align="left">A penalty in seconds added to each transition onto a path with <a href="http://wiki.openstreetmap.org/wiki/Tag:highway%3Dsteps">steps or stairs</a>. Higher values apply larger cost penalties to avoid paths that contain flights of steps.</td>
</tr>
</tbody>
</table>
<h5 id="transit-costing-options">Transit costing options</h5>
<p>These options are available for transit costing when the multimodal costing model is used.</p>
<table>
<thead>
<tr>
<th align="left">Transit options</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>use_bus</code></td>
<td align="left">User's desire to use buses.  Range of values from 0 (try to avoid buses) to 1 (strong preference for riding buses).</td>
</tr>
<tr>
<td align="left"><code>use_rail</code></td>
<td align="left">User's desire to use rail/subway/metro.  Range of values from 0 (try to avoid rail) to 1 (strong preference for riding rail).</td>
</tr>
<tr>
<td align="left"><code>use_transfers</code></td>
<td align="left">User's desire to favor transfers.  Range of values from 0 (try to avoid transfers) to 1 (totally comfortable with transfers).</td>
</tr>
</tbody>
</table>
<p>For example, this is a route favoring buses, but also this person walks at a slower speed (4.1km/h)  <code>http://valhalla.mapzen.com/route?json={"locations":[{"lat":40.749706,"lon":-73.991562,"type":"break","street":"Penn Plaza"},{"lat":40.73093,"lon":-73.991379,"type":"break","street":"Wanamaker Place"}],"costing":"multimodal","costing_options":{"transit":{"use_bus":"1.0","use_rail":"0.0","use_transfers":"0.3"},"pedestrian":{"walking_speed":"4.1"}}}&amp;api_key=mapzen-xxxxxxx</code></p>
<p>Note that you must append your own <a href="https://mapzen.com/developers">Mapzen API key</a> to the URL, following <code>&amp;api_key=</code> at the end.</p>
<h4 id="directions-options">Directions options</h4>
<table>
<thead>
<tr>
<th align="left">Options</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>units</code></td>
<td align="left">Distance units for output. Allowable unit types are miles (or mi) and kilometers (or km). If no unit type is specified, the units default to kilometers.</td>
</tr>
<tr>
<td align="left"><code>language</code></td>
<td align="left">The language of the narration instructions based on the <a href="https://tools.ietf.org/html/bcp47">IETF BCP 47</a> language tag string. If no language is specified or the specified language is unsupported, United States-based English (en-US) is used. Currently supported language tags with alias in parentheses:  cs-CZ (cs), de-DE (de), en-US (en), en-US-x-pirate (pirate), es-ES (es), fr-FR (fr), it-IT (it).</td>
</tr>
<tr>
<td align="left"><code>narrative</code></td>
<td align="left">Flag to allow users to disable narrative production. Locations, shape, length, and time are still returned. The narrative production is enabled by default.</td>
</tr>
</tbody>
</table>
<h4 id="other-request-options">Other request options</h4>
<table>
<thead>
<tr>
<th align="left">Options</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>date_time</code></td>
<td align="left">This is the local date and time at the location.<ul><li><code>type</code><ul><li>0 - Current departure time.</li><li>1 - Specified departure time</li><li>2 - Specified arrival time. Not yet implemented for multimodal costing method.</li></ul></li><li><code>value</code> - the date and time is specified in ISO 8601 format (YYYY-MM-DDThh:mm) in the local time zone of departure or arrival.  For example "2016-07-03T08:06"</li></ul><ul><b>NOTE: This option is not supported for our Matrix service.</b><ul></td>
</tr>
<tr>
<td align="left"><code>out_format</code></td>
<td align="left">Output format. If no <code>out_format</code> is specified, JSON is returned. Future work includes PBF (protocol buffer) support.</td>
</tr>
<tr>
<td align="left"><code>id</code></td>
<td align="left">Name your route request. If <code>id</code> is specified, the naming will be sent thru to the response.</td>
</tr>
</tbody>
</table>
<p>This is an example of a transit route departing on 2016-03-29 at 08:00.
<code>http://valhalla.mapzen.com/route?json={"locations":[{"lat":40.749706,"lon":-73.991562,"type":"break","street":"Penn Plaza"},{"lat":40.73093,"lon":-73.991379,"type":"break","street":"Wanamaker Place"}],"costing":"multimodal","date_time":{"type":1,"value":"2016-03-29T08:00"}}&amp;api_key=mapzen-xxxxxxx</code></p>
<p>Note that you must append your own <a href="https://mapzen.com/developers">Mapzen API key</a> to the URL, following <code>&amp;api_key=</code> at the end.</p>
<h2 id="outputs-of-a-route">Outputs of a route</h2>
<p>If a route has been named in the request using the optional <code>&amp;id=</code> input, then the name will be returned as a string <code>id</code> on the JSON object.</p>
<p>The route results are returned as a <code>trip</code>. This is a JSON object that contains details about the trip, including locations, a summary with basic information about the entire trip, and a list of <code>legs</code>.</p>
<p>Basic trip information includes:</p>
<table>
<thead>
<tr>
<th align="left">Trip Item</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>status</code></td>
<td align="left">Status code.</td>
</tr>
<tr>
<td align="left"><code>status_message</code></td>
<td align="left">Status message.</td>
</tr>
<tr>
<td align="left"><code>units</code></td>
<td align="left">The specified units of length are returned, either kilometers or miles.</td>
</tr>
<tr>
<td align="left"><code>language</code></td>
<td align="left">The language of the narration instructions. If the user specified a language in the directions options and the specified language was supported - this returned value will be equal to the specified value. Otherwise, this value will be the default (en-US) language.</td>
</tr>
<tr>
<td align="left"><code>locations</code></td>
<td align="left">Location information is returned in the same form as it is entered with additional fields to indicate the side of the street.</td>
</tr>
</tbody>
</table>
<p>The summary JSON object includes:</p>
<table>
<thead>
<tr>
<th align="left">Summary Item</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>time</code></td>
<td align="left">Estimated elapsed time to complete the trip.</td>
</tr>
<tr>
<td align="left"><code>length</code></td>
<td align="left">Distance traveled for the entire trip. Units are either miles or kilometers based on the input units specified.</td>
</tr>
<tr>
<td align="left"><code>min_lat</code></td>
<td align="left">Minimum latitude of a bounding box containing the route.</td>
</tr>
<tr>
<td align="left"><code>min_lon</code></td>
<td align="left">Minimum longitude of a bounding box containing the route.</td>
</tr>
<tr>
<td align="left"><code>max_lat</code></td>
<td align="left">Maximum latitude of a bounding box containing the route.</td>
</tr>
<tr>
<td align="left"><code>max_lon</code></td>
<td align="left">Maximum longitude of a bounding box containing the route.</td>
</tr>
</tbody>
</table>
<h3 id="trip-legs-and-maneuvers">Trip legs and maneuvers</h3>
<p>A <code>trip</code> contains one or more <code>legs</code>. For <em>n</em> number of <code>break</code> locations, there are <em>n-1</em> legs. <code>Through</code> locations do not create separate legs.</p>
<p>Each leg of the trip includes a summary, which is comprised of the same information as a trip summary but applied to the single leg of the trip. It also includes a <code>shape</code>, which is an <a href="https://developers.google.com/maps/documentation/utilities/polylinealgorithm">encoded polyline</a> of the route path, and a list of <code>maneuvers</code> as a JSON array. For more about decoding route shapes, see these <a href="../decoding/">code examples</a>.</p>
<p>Each maneuver includes:</p>
<table>
<thead>
<tr>
<th align="left">Maneuver Item</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>type</code></td>
<td align="left">Type of maneuver. See below for a list.</td>
</tr>
<tr>
<td align="left"><code>instruction</code></td>
<td align="left">Written maneuver instruction. Describes the maneuver, such as "Turn right onto Main Street".</td>
</tr>
<tr>
<td align="left"><code>verbal_transition_alert_instruction</code></td>
<td align="left">Text suitable for use as a verbal alert in a navigation application. The transition alert instruction will prepare the user for the forthcoming transition. For example: "Turn right onto North Prince Street".</td>
</tr>
<tr>
<td align="left"><code>verbal_pre_transition_instruction</code></td>
<td align="left">Text suitable for use as a verbal message immediately prior to the maneuver transition. For example "Turn right onto North Prince Street, U.S. 2 22".</td>
</tr>
<tr>
<td align="left"><code>verbal_post_transition_instruction</code></td>
<td align="left">Text suitable for use as a verbal message immediately after the maneuver transition. For example "Continue on U.S. 2 22 for 3.9 miles".</td>
</tr>
<tr>
<td align="left"><code>street_names</code></td>
<td align="left">List of street names that are consistent along the entire maneuver.</td>
</tr>
<tr>
<td align="left"><code>begin_street_names</code></td>
<td align="left">When present, these are the street names at the beginning of the maneuver (if they are different than the names that are consistent along the entire maneuver).</td>
</tr>
<tr>
<td align="left"><code>time</code></td>
<td align="left">Estimated time along the maneuver in seconds.</td>
</tr>
<tr>
<td align="left"><code>length</code></td>
<td align="left">Maneuver length in the units specified.</td>
</tr>
<tr>
<td align="left"><code>begin_shape_index</code></td>
<td align="left">Index into the list of shape points for the start of the maneuver.</td>
</tr>
<tr>
<td align="left"><code>end_shape_index</code></td>
<td align="left">Index into the list of shape points for the end of the maneuver.</td>
</tr>
<tr>
<td align="left"><code>toll</code></td>
<td align="left">True if the maneuver has any toll, or portions of the maneuver are subject to a toll.</td>
</tr>
<tr>
<td align="left"><code>rough</code></td>
<td align="left">True if the maneuver is unpaved or rough pavement, or has any portions that have rough pavement.</td>
</tr>
<tr>
<td align="left"><code>gate</code></td>
<td align="left">True if a gate is encountered on this maneuver.</td>
</tr>
<tr>
<td align="left"><code>ferry</code></td>
<td align="left">True if a ferry is encountered on this maneuver.</td>
</tr>
<tr>
<td align="left"><code>sign</code></td>
<td align="left">Contains the interchange guide information at a road junction associated with this maneuver. See below for details.</td>
</tr>
<tr>
<td align="left"><code>roundabout_exit_count</code></td>
<td align="left">The spoke to exit roundabout after entering.</td>
</tr>
<tr>
<td align="left"><code>depart_instruction</code></td>
<td align="left">Written depart time instruction. Typically used with a transit maneuver, such as "Depart: 8:04 AM from 8 St - NYU".</td>
</tr>
<tr>
<td align="left"><code>verbal_depart_instruction</code></td>
<td align="left">Text suitable for use as a verbal depart time instruction. Typically used with a transit maneuver, such as "Depart at 8:04 AM from 8 St - NYU".</td>
</tr>
<tr>
<td align="left"><code>arrive_instruction</code></td>
<td align="left">Written arrive time instruction. Typically used with a transit maneuver, such as "Arrive: 8:10 AM at 34 St - Herald Sq".</td>
</tr>
<tr>
<td align="left"><code>verbal_arrive_instruction</code></td>
<td align="left">Text suitable for use as a verbal arrive time instruction. Typically used with a transit maneuver, such as "Arrive at 8:10 AM at 34 St - Herald Sq".</td>
</tr>
<tr>
<td align="left"><code>transit_info</code></td>
<td align="left">Contains the attributes that descibe a specific transit route. See below for details.</td>
</tr>
<tr>
<td align="left"><code>verbal_multi_cue</code></td>
<td align="left">True if the <code>verbal_pre_transition_instruction</code> has been appended with the verbal instruction of the next maneuver.</td>
</tr>
<tr>
<td align="left"><code>travel_mode</code></td>
<td align="left">Travel mode.<ul><li>"drive"</li><li>"pedestrian"</li><li>"bicycle"</li><li>"transit"</li></ul></td>
</tr>
<tr>
<td align="left"><code>travel_type</code></td>
<td align="left">Travel type for drive.<ul><li>"car"</li></ul>Travel type for pedestrian.<ul><li>"foot"</li></ul>Travel type for bicycle.<ul><li>"road"</li></ul>Travel type for transit.<ul><li>Tram or light rail = "tram"</li><li>Metro or subway = "metro"</li><li>Rail = "rail"</li><li>Bus = "bus"</li><li>Ferry = "ferry"</li><li>Cable car = "cable_car"</li><li>Gondola = "gondola"</li><li>Funicular = "funicular"</li></ul></td>
</tr>
</tbody>
</table>
<p>For the maneuver <code>type</code>, the following are available:</p>
<pre><code>kNone = 0;
kStart = 1;
kStartRight = 2;
kStartLeft = 3;
kDestination = 4;
kDestinationRight = 5;
kDestinationLeft = 6;
kBecomes = 7;
kContinue = 8;
kSlightRight = 9;
kRight = 10;
kSharpRight = 11;
kUturnRight = 12;
kUturnLeft = 13;
kSharpLeft = 14;
kLeft = 15;
kSlightLeft = 16;
kRampStraight = 17;
kRampRight = 18;
kRampLeft = 19;
kExitRight = 20;
kExitLeft = 21;
kStayStraight = 22;
kStayRight = 23;
kStayLeft = 24;
kMerge = 25;
kRoundaboutEnter = 26;
kRoundaboutExit = 27;
kFerryEnter = 28;
kFerryExit = 29;
kTransit = 30;
kTransitTransfer = 31;
kTransitRemainOn = 32;
kTransitConnectionStart = 33;
kTransitConnectionTransfer = 34;
kTransitConnectionDestination = 35;
kPostTransitConnectionDestination = 36;
</code></pre>

<p>The maneuver <code>sign</code> may contain four lists of interchange sign elements as follows:</p>
<ul>
<li><code>exit_number_elements</code> = list of exit number elements. If an exit number element exists, it is typically just one value.</li>
<li><code>exit_branch_elements</code> = list of exit branch elements. The exit branch element text is the subsequent road name or route number after the sign.</li>
<li><code>exit_toward_elements</code> = list of exit toward elements. The exit toward element text is the location where the road ahead goes - the location is typically a control city, but may also be a future road name or route number.</li>
<li><code>exit_name_elements</code> = list of exit name elements. The exit name element is the interchange identifier - typically not used in the US.</li>
</ul>
<p>Each maneuver sign element includes:</p>
<table>
<thead>
<tr>
<th align="left">Maneuver Sign Element Item</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>text</code></td>
<td align="left">Interchange sign text. <ul><li>exit number example: 91B.</li><li>exit branch example: I 95 North.</li><li>exit toward example: New York.</li><li>exit name example: Gettysburg Pike.</li><ul></td>
</tr>
<tr>
<td align="left"><code>consecutive_count</code></td>
<td align="left">The frequency of this sign element within a set a consecutive signs. This item is optional.</td>
</tr>
</tbody>
</table>
<p>A maneuver <code>transit_info</code> includes:</p>
<table>
<thead>
<tr>
<th align="left">Maneuver Transit Route Item</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>onestop_id</code></td>
<td align="left">Global transit route identifier from Transitland.</td>
</tr>
<tr>
<td align="left"><code>short_name</code></td>
<td align="left">Short name describing the transit route. For example "N".</td>
</tr>
<tr>
<td align="left"><code>long_name</code></td>
<td align="left">Long name describing the transit route. For example "Broadway Express".</td>
</tr>
<tr>
<td align="left"><code>headsign</code></td>
<td align="left">The sign on a public transport vehicle that identifies the route destination to passengers. For example "ASTORIA - DITMARS BLVD".</td>
</tr>
<tr>
<td align="left"><code>color</code></td>
<td align="left">The numeric color value associated with a transit route. The value for yellow would be "16567306".</td>
</tr>
<tr>
<td align="left"><code>text_color</code></td>
<td align="left">The numeric text color value associated with a transit route. The value for black would be "0".</td>
</tr>
<tr>
<td align="left"><code>description</code></td>
<td align="left">The description of the the transit route. For example "Trains operate from Ditmars Boulevard, Queens, to Stillwell Avenue, Brooklyn, at all times. N trains in Manhattan operate along Broadway and across the Manhattan Bridge to and from Brooklyn. Trains in Brooklyn operate along 4th Avenue, then through Borough Park to Gravesend. Trains typically operate local in Queens, and either express or local in Manhattan and Brooklyn, depending on the time. Late night trains operate via Whitehall Street, Manhattan. Late night service is local".</td>
</tr>
<tr>
<td align="left"><code>operator_onestop_id</code></td>
<td align="left">Global operator/agency identifier from Transitland.</td>
</tr>
<tr>
<td align="left"><code>operator_name</code></td>
<td align="left">Operator/agency name. For example "BART", "King County Marine Divison", etc.  Short name is used over long name.</td>
</tr>
<tr>
<td align="left"><code>operator_url</code></td>
<td align="left">Operator/agency URL. For example "http://web.mta.info/".</td>
</tr>
<tr>
<td align="left"><code>transit_stops</code></td>
<td align="left">A list of the stops/stations associated with a specific transit route. See below for details.</td>
</tr>
</tbody>
</table>
<p>A <code>transit_stop</code> includes:</p>
<table>
<thead>
<tr>
<th align="left">Transit Stop Item</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>type</code></td>
<td align="left">The type of stop (simple stop=0; station=1)</td>
</tr>
<tr>
<td align="left"><code>onestop_id</code></td>
<td align="left">Global transit stop identifier from Transitland.</td>
</tr>
<tr>
<td align="left"><code>name</code></td>
<td align="left">Name of the stop/station. For example "14 St - Union Sq".</td>
</tr>
<tr>
<td align="left"><code>arrival_date_time</code></td>
<td align="left">Arrival date/time using the ISO 8601 format (YYYY-MM-DDThh:mm). For example "2015-12-29T08:06".</td>
</tr>
<tr>
<td align="left"><code>departure_date_time</code></td>
<td align="left">Departure date/time using the ISO 8601 format (YYYY-MM-DDThh:mm). For example "2015-12-29T08:06".</td>
</tr>
<tr>
<td align="left"><code>is_parent_stop</code></td>
<td align="left">True if this stop is a marked as a parent stop.</td>
</tr>
<tr>
<td align="left"><code>assumed_schedule</code></td>
<td align="left">True if the times are based on an assumed schedule because the actual schedule is not known.</td>
</tr>
<tr>
<td align="left"><code>lat</code></td>
<td align="left">Latitude of the transit stop in degrees.</td>
</tr>
<tr>
<td align="left"><code>lon</code></td>
<td align="left">Longitude of the transit stop in degrees.</td>
</tr>
</tbody>
</table>
<p>Continuing with the earlier routing example from the Detroit, Michigan area, a maneuver such as this one may be returned with that request: <code>{"begin_shape_index":0,"length":0.109,"end_shape_index":1,"instruction":"Go south on Appleton.","street_names":["Appleton"],"type":1,"time":0}</code></p>
<p>In the future, look for additional maneuver information to enhance navigation applications, including landmark usage.</p>
<h3 id="return-codes-and-conditions">Return codes and conditions</h3>
<p>The following is a table of error conditions that may occur for a particular request. In general, the service follows the <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP specification</a>. That is to say that <code>5xx</code> returns are generally ephemeral server problems that should be resolved shortly or are the result of a bug. <code>4xx</code> returns are used to mark requests that cannot be carried out, generally due to bad input in the request or problems with the underlying data. A <code>2xx</code> return is expected when there is a successful route result or <code>trip</code>, as described above.</p>
<table>
<thead>
<tr>
<th align="left">Code</th>
<th align="left">Body</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">200</td>
<td align="left"><em>your_trip_json</em></td>
<td align="left">A happy bit of json describing your <code>trip</code> result</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Failed to parse json request</td>
<td align="left">You need a valid json request</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Failed to parse location</td>
<td align="left">You need a valid location object in your json request</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Failed to parse correlated location</td>
<td align="left">There was a problem with the location once correlated to the route network</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Insufficiently specified required parameter 'locations'</td>
<td align="left">You forgot the locations parameter</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">No edge/node costing provided</td>
<td align="left">You forgot the costing parameter</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Insufficient number of locations provided</td>
<td align="left">You didn't provide enough locations</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Exceeded max route locations of X</td>
<td align="left">You are asking for too many locations</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Locations are in unconnected regions. Go check/edit the map at osm.org</td>
<td align="left">You are routing between regions of no connectivity</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">No costing method found for 'X'</td>
<td align="left">You are asking for a non-existent costing mode</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Path distance exceeds the max distance limit</td>
<td align="left">You want to travel further than this mode allows</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">No suitable edges near location</td>
<td align="left">There were no edges applicable to your mode of travel near the input location</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">No data found for location</td>
<td align="left">There was no route data tile at the input location</td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">No path could be found for input</td>
<td align="left">There was no path found between the input locations</td>
</tr>
<tr>
<td align="left">404</td>
<td align="left">Try any of: '/route' '/locate'</td>
<td align="left">You asked for an invalid path</td>
</tr>
<tr>
<td align="left">405</td>
<td align="left">Try a POST or GET request instead</td>
<td align="left">We only support GET and POST requests</td>
</tr>
<tr>
<td align="left">500</td>
<td align="left">Failed to parse intermediate request format</td>
<td align="left">Had a problem reading an intermediate request format</td>
</tr>
<tr>
<td align="left">500</td>
<td align="left">Failed to parse TripPath</td>
<td align="left">Had a problem reading the computed path from Protobuf</td>
</tr>
<tr>
<td align="left">500</td>
<td align="left">Could not build directions for TripPath</td>
<td align="left">Had a problem using the trip path to create TripDirections</td>
</tr>
<tr>
<td align="left">500</td>
<td align="left">Failed to parse TripDirections</td>
<td align="left">Had a problem using the trip directions to serialize a json response</td>
</tr>
<tr>
<td align="left">501</td>
<td align="left">Not implemented</td>
<td align="left">Not Implemented</td>
</tr>
</tbody>
</table></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
